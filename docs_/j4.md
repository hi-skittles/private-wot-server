# Complete Reference Document for Event Types

This document provides a comprehensive reference for all event types in the game system, including their structure, purpose, and capabilities. It serves as a complete guide for creating different types of events.

## 1. Event Type Constants

Events are categorized using two main enumeration classes:

### 1.1 EVENT_TYPE
Defines the server-side event types:
```python
class EVENT_TYPE:
    ACTION = 1                # Discounts, bonuses, and modifiers
    BATTLE_QUEST = 2          # Regular battle quests
    TOKEN_QUEST = 3           # Token-based quests
    HISTORICAL_BATTLES = 4    # Historical battle events
    FORT_QUEST = 5            # Stronghold/Fortress quests
    PERSONAL_QUEST = 6        # Personal missions/quests
    REF_SYSTEM_QUEST = 7      # Referral system quests
    POTAPOV_QUEST = 8         # Potapov (campaign) quests
```

### 1.2 EVENT_CLIENT_DATA
Defines how event data is organized in the client:
```python
class EVENT_CLIENT_DATA:
    ACTION = 1                # Action events data
    ACTION_REV = 2            # Action events revision
    QUEST = 3                 # Regular quests data
    QUEST_REV = 4             # Regular quests revision
    HISTORICAL_BATTLES = 5    # Historical battles data
    HISTORICAL_BATTLES_REV = 6 # Historical battles revision
    INGAME_EVENTS = 7         # In-game events data
    INGAME_EVENTS_REV = 8     # In-game events revision
    NOTIFICATIONS = 9         # Event notifications data
    NOTIFICATIONS_REV = 10    # Event notifications revision
    PERSONAL_QUEST = 11       # Personal quests data
    PERSONAL_QUEST_REV = 12   # Personal quests revision
    FORT_QUEST = 13           # Fortress quests data
    FORT_QUEST_REV = 14       # Fortress quests revision
```

## 2. Event Classes

The system implements different event types through specialized classes:

### 2.1 ServerEventAbstract
Base abstract class for all server events with common functionality:
- Time management (start/finish times)
- Availability checking
- User interface properties
- Basic event data handling

### 2.2 Quest
Extends ServerEventAbstract for quest-type events:
- Tracks completion progress
- Manages pre-battle and post-battle conditions
- Handles bonus conditions
- Supports parent/child quest relationships

### 2.3 PersonalQuest
Extends Quest with additional expiry time functionality.

### 2.4 Action
Extends ServerEventAbstract for discount/bonus events:
- Manages economic modifiers
- Applies discounts to items, vehicles, etc.

### 2.5 HistoricalBattle
Extends ServerEventAbstract for historical battle events:
- Manages battle configurations
- Handles vehicle restrictions and loadouts
- Provides historical context and information

### 2.6 PotapovQuest
Extends Quest for campaign-style quests:
- Organized in tiles and seasons
- Supports main and additional objectives
- Tracks multiple completion states

## 3. Detailed Event Type Reference

### 3.1 ACTION Events

#### Purpose
Apply temporary economic changes, discounts, and bonuses to various game aspects.

#### Data Structure
```python
{
    'type': EVENT_TYPE.ACTION,
    'id': 'unique_action_id',
    'startTime': 1586541600,  # Unix timestamp
    'finishTime': 1586627999, # Unix timestamp
    'steps': [
        {
            'name': 'modifier_name',
            'params': {
                # Modifier-specific parameters
            }
        }
    ]
}
```

#### Available Modifiers

##### Economic Modifiers (EconomicsSet/EconomicsMul)
- `creditsTankmanCost` - Tankman recruitment cost
- `goldTankmanCost` - Gold tankman recruitment cost
- `changeRoleCost` - Role change cost
- `creditsDropSkillsCost` - Credits cost for dropping skills
- `goldDropSkillsCost` - Gold cost for dropping skills
- `exchangeRate` - Gold to credits exchange rate
- `exchangeRateForShellsAndEqs` - Exchange rate for shells and equipment
- `paidRemovalCost` - Equipment removal cost
- `passportChangeCost` - Name change cost
- `clanCreationCost` - Clan creation cost
- `premiumPacket1/3/7/30/180/360` - Premium account packages

##### Vehicle Price Modifiers
- `vehPrice` - Specific vehicle discounts
- `vehPriceAll` - All vehicles discount
- `vehPriceNation` - Nation-specific vehicle discounts
- `vehRentPrice` - Vehicle rental discounts
- `vehSellPrice` - Vehicle sell price bonuses

##### Equipment and Consumables Modifiers
- `equipmentPrice` - Specific equipment discounts
- `equipmentPriceAll` - All equipment discount
- `optDevicePrice` - Specific optional devices discounts
- `optDevicePriceAll` - All optional devices discount
- `shellPrice` - Specific shell discounts
- `shellPriceAll` - All shells discount
- `shellPriceNation` - Nation-specific shell discounts

##### Customization Modifiers
- `camouflagePriceFactor` - Camouflage price discount
- `emblemPriceFactorByGroups` - Emblem price discount by groups

#### Example
```python
{
    'type': EVENT_TYPE.ACTION,
    'id': 'weekend_special',
    'startTime': 1586541600,
    'finishTime': 1586714399,
    'steps': [
        {
            'name': 'creditsTankmanCost',
            'params': {
                'rate': 0.5  # 50% discount on tankman recruitment
            }
        },
        {
            'name': 'vehPriceAll',
            'params': {
                'goldPriceMult': 0.85,  # 15% discount on gold prices
                'creditsPriceMult': 0.85  # 15% discount on credit prices
            }
        }
    ]
}
```

### 3.2 BATTLE_QUEST Events

#### Purpose
Regular quests that require players to complete specific objectives in battles.

#### Data Structure
```python
{
    'type': EVENT_TYPE.BATTLE_QUEST,
    'id': 'quest_id',
    'startTime': 1586541600,
    'finishTime': 1586627999,
    'conditions': {
        'preBattle': {
            'account': {...},  # Account requirements
            'vehicle': {...},  # Vehicle requirements
            'battle': {...}    # Battle type requirements
        },
        'bonus': {...},        # Bonus conditions
        'postBattle': {...}    # Post-battle conditions
    },
    'bonus': {
        # Rewards for completion
        'credits': 10000,
        'xp': 5000,
        'items': {...},
        'tokens': {...}
    }
}
```

#### Condition Types
- **preBattle.account**: Player account requirements (level, clan, etc.)
- **preBattle.vehicle**: Vehicle requirements (nation, class, level, etc.)
- **preBattle.battle**: Battle type requirements (random, team, etc.)
- **bonus**: Conditions for receiving bonuses (win count, etc.)
- **postBattle**: Performance requirements (damage, kills, etc.)

#### Example
```python
{
    'type': EVENT_TYPE.BATTLE_QUEST,
    'id': 'daily_mission_1',
    'startTime': 1586541600,
    'finishTime': 1586627999,
    'conditions': {
        'preBattle': {
            'account': {},  # No account restrictions
            'vehicle': {
                'level': [6, 7, 8, 9, 10],  # Tier 6-10 vehicles
                'classes': ['mediumTank', 'heavyTank']  # Medium and heavy tanks only
            },
            'battle': {
                'bonusTypes': [1]  # Random battles only
            }
        },
        'bonus': {
            'bonusLimit': 3  # Can complete up to 3 times
        },
        'postBattle': {
            'win': True,  # Must win the battle
            'damage': {
                'value': 1500  # Must deal at least 1500 damage
            }
        }
    },
    'bonus': {
        'credits': 25000,
        'xp': 2000
    }
}
```

### 3.3 TOKEN_QUEST Events

#### Purpose
Quests that reward players with special tokens that can be used to unlock other content or be exchanged for rewards.

#### Data Structure
Similar to BATTLE_QUEST, but with token rewards:
```python
{
    'type': EVENT_TYPE.TOKEN_QUEST,
    'id': 'token_quest_id',
    # Other fields similar to BATTLE_QUEST
    'bonus': {
        'tokens': {
            'token_id': {'count': 1}
        }
    }
}
```

#### Example
```python
{
    'type': EVENT_TYPE.TOKEN_QUEST,
    'id': 'special_token_mission',
    'startTime': 1586541600,
    'finishTime': 1586627999,
    'conditions': {
        'preBattle': {
            'account': {},
            'vehicle': {},
            'battle': {'bonusTypes': [1]}
        },
        'bonus': {'bonusLimit': 1},
        'postBattle': {
            'win': True,
            'alive': True
        }
    },
    'bonus': {
        'tokens': {
            'event_token': {'count': 1}
        }
    }
}
```

### 3.4 HISTORICAL_BATTLES Events

#### Purpose
Special battle events that recreate historical tank battles with historically accurate vehicle configurations and teams.

#### Data Structure
```python
{
    'type': EVENT_TYPE.HISTORICAL_BATTLES,
    'id': 'historical_battle_id',
    'startTime': 1586541600,
    'finishTime': 1586627999,
    'arenaTypeID': 45,  # Arena type ID
    'vehSides': {
        '5393': 'A',  # Vehicle ID and team assignment
        '6145': 'B'
    },
    'vehicles': {
        '5393': {
            'ammoList': [...],  # Predefined ammo loadout
            'modules': {...}    # Predefined modules
        }
    },
    'localized_data': {
        'title': {'en': 'Battle Name'},
        'shortDescr': {'en': 'Short description'},
        'longDescr': {'en': 'Detailed description'},
        'sideNames': {'A': 'Side A Name', 'B': 'Side B Name'}
    }
}
```

#### Example
```python
{
    'type': EVENT_TYPE.HISTORICAL_BATTLES,
    'id': 'kursk_1943',
    'startTime': 1586541600,
    'finishTime': 1586627999,
    'arenaTypeID': 45,
    'vehSides': {
        '5393': 'A',  # Soviet T-34
        '6145': 'B'   # German Tiger
    },
    'vehicles': {
        '5393': {
            'ammoList': [[3841, 30], [3843, 20]],  # 30 AP shells, 20 HE shells
            'modules': {
                'gun': 1234,
                'turret': 5678,
                'engine': 9012,
                'chassis': 3456,
                'radio': 7890
            }
        },
        '6145': {
            'ammoList': [[4001, 30], [4003, 20]],
            'modules': {...}
        }
    },
    'localized_data': {
        'title': {'en': 'Battle of Kursk'},
        'shortDescr': {'en': 'Historical recreation of the Kursk battle'},
        'longDescr': {'en': 'Detailed description...'},
        'sideNames': {'A': 'Soviet', 'B': 'German'}
    }
}
```

### 3.5 FORT_QUEST Events

#### Purpose
Quests specific to the Stronghold/Fortress game mode.

#### Data Structure
Similar to BATTLE_QUEST, but with stronghold-specific conditions:
```python
{
    'type': EVENT_TYPE.FORT_QUEST,
    'id': 'fort_quest_id',
    # Other fields similar to BATTLE_QUEST
    'conditions': {
        'preBattle': {
            'battle': {
                'bonusTypes': [10, 11]  # Sortie and Fort Battle types
            }
        }
    }
}
```

#### Example
```python
{
    'type': EVENT_TYPE.FORT_QUEST,
    'id': 'stronghold_weekly',
    'startTime': 1586541600,
    'finishTime': 1587146399,  # One week duration
    'conditions': {
        'preBattle': {
            'account': {},
            'vehicle': {'level': [8, 10]},  # Tier 8 or 10 only
            'battle': {'bonusTypes': [10, 11]}  # Sortie and Fort Battle types
        },
        'bonus': {'bonusLimit': 10},  # Up to 10 completions
        'postBattle': {
            'win': True
        }
    },
    'bonus': {
        'credits': 50000,
        'fortResource': 100  # Stronghold-specific resource
    }
}
```

### 3.6 PERSONAL_QUEST Events

#### Purpose
More complex missions that often form part of campaigns, with multiple stages and exclusive rewards like unique vehicles.

#### Data Structure
Similar to BATTLE_QUEST, but with additional fields:
```python
{
    'type': EVENT_TYPE.PERSONAL_QUEST,
    'id': 'personal_quest_id',
    # Other fields similar to BATTLE_QUEST
    'bonus': {
        'vehicles': {
            '6401': {}  # Reward tank
        },
        'tankmen': {...}  # Reward crew member
    }
}
```

#### Example
```python
{
    'type': EVENT_TYPE.PERSONAL_QUEST,
    'id': 'personal_mission_1',
    'startTime': 1586541600,
    'finishTime': 1617999999,  # Long duration
    'conditions': {
        'preBattle': {
            'account': {},
            'vehicle': {'classes': ['heavyTank']},  # Heavy tanks only
            'battle': {'bonusTypes': [1]}  # Random battles only
        },
        'bonus': {'bonusLimit': 1},  # One-time completion
        'postBattle': {
            'win': True,
            'damage': {'value': 3000},  # Deal 3000+ damage
            'kills': {'value': 3}  # Get 3+ kills
        }
    },
    'bonus': {
        'credits': 100000,
        'items': {'4001': 3},  # 3 premium consumables
        'tankmen': {
            'tmanToken': {
                'nation': 0,  # USSR
                'role': 'commander',
                'skills': ['brotherhood', 'repair'],
                'rankID': 6  # 100% trained
            }
        }
    }
}
```

### 3.7 REF_SYSTEM_QUEST Events

#### Purpose
Quests related to the referral program system.

#### Data Structure
Similar to TOKEN_QUEST, but with referral-specific conditions:
```python
{
    'type': EVENT_TYPE.REF_SYSTEM_QUEST,
    'id': 'ref_quest_id',
    # Other fields similar to TOKEN_QUEST
    'conditions': {
        'preBattle': {
            'account': {
                'refSystemFlags': [...]  # Referral system flags
            }
        }
    }
}
```

#### Example
```python
{
    'type': EVENT_TYPE.REF_SYSTEM_QUEST,
    'id': 'referral_program_1',
    'startTime': 1586541600,
    'finishTime': 1617999999,
    'conditions': {
        'preBattle': {
            'account': {
                'refSystemFlags': [1]  # New player flag
            },
            'vehicle': {},
            'battle': {'bonusTypes': [1]}
        },
        'bonus': {'bonusLimit': 1},
        'postBattle': {
            'win': True
        }
    },
    'bonus': {
        'tokens': {
            'ref_token': {'count': 1}
        },
        'premium': 3  # 3 days of premium
    }
}
```

### 3.8 POTAPOV_QUEST Events

#### Purpose
Campaign-style quests organized in tiles and seasons, with main and additional objectives.

#### Data Structure
More complex structure with main and additional objectives:
```python
{
    'type': EVENT_TYPE.POTAPOV_QUEST,
    'id': 'potapov_quest_id',
    'tileID': 1,  # Tile ID
    'chainID': 2,  # Chain ID within the tile
    'seasonID': 1,  # Season ID
    'isInitial': False,  # Whether it's the first quest in a chain
    'isFinal': False,  # Whether it's the last quest in a chain
    'mainQuestInfo': {
        'id': 'main_objective_id',
        # Quest data for main objective
    },
    'addQuestInfo': {
        'id': 'additional_objective_id',
        # Quest data for additional objective
    }
}
```

#### Example
```python
{
    'type': EVENT_TYPE.POTAPOV_QUEST,
    'id': 'campaign1_tile2_chain3_quest1',
    'tileID': 2,
    'chainID': 3,
    'seasonID': 1,
    'isInitial': True,
    'isFinal': False,
    'vehClasses': ['mediumTank'],  # Medium tanks only
    'minLevel': 6,  # Minimum vehicle tier
    'mainQuestInfo': {
        'id': 'main_obj_1',
        'conditions': {
            'postBattle': {
                'win': True,
                'damage': {'value': 2000}
            }
        },
        'bonus': {
            'tokens': {'campaign1_token': {'count': 1}}
        }
    },
    'addQuestInfo': {
        'id': 'add_obj_1',
        'conditions': {
            'postBattle': {
                'win': True,
                'damage': {'value': 2000},
                'kills': {'value': 3}
            }
        },
        'bonus': {
            'credits': 50000
        }
    }
}
```

## 4. Client-Side Event Data Types

### 4.1 NOTIFICATIONS (EVENT_CLIENT_DATA.NOTIFICATIONS)

#### Purpose
Display messages to players about upcoming events, achievements, or special offers.

#### Data Structure
```python
{
    'type': 'notification_type',
    'data': 'notification_data',
    'text': {
        'en': 'English text',
        'ru': 'Russian text'
    },
    'requiredTokens': []  # Tokens required to see this notification
}
```

#### Example
```python
{
    'type': 'promo_notification',
    'data': 'special_event_coming',
    'text': {
        'en': 'Special event coming soon!',
        'ru': 'Скоро специальное событие!'
    },
    'requiredTokens': []
}
```

### 4.2 INGAME_EVENTS (EVENT_CLIENT_DATA.INGAME_EVENTS)

#### Purpose
Enable special game modes with unique rules, maps, or vehicle restrictions.

#### Data Structure
```python
{
    'eventBattles': {
        'vehicleTags': [...],  # Vehicle tags for the event
        'vehicles': [...],     # Specific vehicle IDs
        'enabled': True,       # Whether the event is enabled
        'arenaTypeID': 100     # Arena type ID
    }
}
```

#### Example
```python
{
    'eventBattles': {
        'vehicleTags': ['halloween'],
        'vehicles': [12345, 67890],
        'enabled': True,
        'arenaTypeID': 100
    }
}
```

## 5. Event Processing

### 5.1 Event Transmission
1. Events are stored in the player's account as compressed data
2. Data is organized by EVENT_CLIENT_DATA types
3. Each type has a corresponding revision number for synchronization

### 5.2 Client-Side Processing
1. The EventsCache class decompresses and deserializes event data
2. Events are converted to appropriate event objects (Action, Quest, etc.)
3. UI components subscribe to events.onEventsDataChanged() to update when events change

### 5.3 Event Availability
Events can be restricted by:
- Time (start/finish times)
- Day of week (weekDays)
- Time of day (activeTimeIntervals)
- Account requirements
- Vehicle requirements

## 6. Best Practices for Creating Events

1. **Always set appropriate time limits**:
   - startTime and finishTime are required for proper event lifecycle
   - Consider using weekDays and activeTimeIntervals for recurring events

2. **Use appropriate event types**:
   - ACTION for discounts and economic changes
   - BATTLE_QUEST for standard missions
   - TOKEN_QUEST for special token rewards
   - PERSONAL_QUEST for campaign-style missions

3. **Balance conditions and rewards**:
   - More difficult conditions should offer better rewards
   - Consider bonusLimit to control how many times a player can complete a quest

4. **Test event visibility**:
   - Use isHidden=True for events that should not appear in the UI
   - Use isGuiDisabled=True for events that should appear but not be interactive

5. **Organize related events**:
   - Use parent/child relationships for quest chains
   - Group related quests with similar IDs or prefixes

6. **Provide clear localized information**:
   - Always include localized name and description
   - For complex events, provide detailed instructions

7. **Consider performance**:
   - Avoid creating too many simultaneous events
   - Use efficient condition checks to minimize server load